function FrontBase(){}function Auth(){var t=this;t.maskWrapper=$(".mask-wrapper"),t.scrollWrapper=$(".scroll-wrapper"),t.smsCaptcha=$(".sms-captcha-btn")}FrontBase.prototype.run=function(){this.listenAuthBoxHover()},FrontBase.prototype.listenAuthBoxHover=function(){var t=$(".auth-box"),n=$(".user-more-box");t.hover(function(){n.show()},function(){n.hide()})},Auth.prototype.run=function(){var t=this;t.listenShowHideEvent(),t.listenSwitchEvent(),t.listenSigninEvent(),t.listenImgCaptchaEvent(),t.listenSmsCaptchaEvent(),t.listenSignupEvent()},Auth.prototype.showEvent=function(){this.maskWrapper.show()},Auth.prototype.hideEvent=function(){this.maskWrapper.hide()},Auth.prototype.smsSuccessEvent=function(){var t=this;t.smsCaptcha.addClass("disabled");var n=10;t.smsCaptcha.unbind("click");var e=setInterval(function(){t.smsCaptcha.text(n+"s"),--n<=0&&(clearInterval(e),t.smsCaptcha.removeClass("disabled"),t.smsCaptcha.text("发送验证码"),t.listenSmsCaptchaEvent())},1e3)},Auth.prototype.listenShowHideEvent=function(){var t=this,n=$(".signin-btn"),e=$(".signup-btn"),s=$(".close-btn");n.click(function(){t.showEvent(),t.scrollWrapper.css({left:0})}),e.click(function(){t.showEvent(),t.scrollWrapper.css({left:-400})}),s.click(function(){t.hideEvent(),$(".form-control").val("")})},Auth.prototype.listenSwitchEvent=function(){var n=this;$(".switch").click(function(){var t=n.scrollWrapper.css("left");(t=parseInt(t))<0?n.scrollWrapper.animate({left:"0"}):n.scrollWrapper.animate({left:"-400px"})})},Auth.prototype.listenImgCaptchaEvent=function(){var t=$(".img-captcha");t.click(function(){t.attr("src","/account/img_captcha/?random="+Math.random())})},Auth.prototype.listenSmsCaptchaEvent=function(){var n=this,t=$(".sms-captcha-btn"),e=$(".signup-group input[name='telephone']"),s=/^[1][3,4,5,7,8,9][0-9]{9}$/;t.click(function(){var t=e.val();s.test(t)?(messageBox.showInfo("短信验证码发送成功！"),blogajax.get({url:"/account/sms_captcha/",data:{telephone:t},success:function(t){200===t.code&&n.smsSuccessEvent()},fail:function(t){console.log(t)}})):messageBox.showError("请输入正确的手机号码！")})},Auth.prototype.listenSigninEvent=function(){var t=$(".signin-group"),s=t.find("input[name='telephone']"),o=t.find("input[name='password']"),a=t.find("input[name='remember']");t.find(".submit-btn").click(function(){var t=s.val(),n=o.val(),e=a.prop("checked");!t&&n&&messageBox.showError("请输入手机号码！"),!n&&t&&messageBox.showError("请输入密码！"),t&&n&&blogajax.post({url:"/account/login/",data:{telephone:t,password:n,remember:e?1:0},success:function(t){console.log(t),200===t.code&&(console.log(t),messageBox.showInfo("登录成功"),setTimeout(function(){window.location.reload()},500))}})})},Auth.prototype.listenSignupEvent=function(){var m=$(".signup-group");m.find(".submit-btn").click(function(t){t.preventDefault();var n=m.find("input[name='telephone']"),e=m.find("input[name='username']"),s=m.find("input[name='img_captcha']"),o=m.find("input[name='password1']"),a=m.find("input[name='password2']"),i=m.find("input[name='sms_captcha']"),c=n.val(),r=e.val(),p=s.val(),u=o.val(),l=a.val(),h=i.val();blogajax.post({url:"/account/register/",data:{telephone:c,username:r,img_captcha:p,password1:u,password2:l,sms_captcha:h},success:function(t){200===t.code&&(console.log(t),messageBox.showInfo("注册成功"),setTimeout(function(){window.location.reload()},500))}})})},$(function(){(new Auth).run()}),$(function(){(new FrontBase).run()}),$(function(){window.template&&(template.defaults.imports.timeNormal=function(t){return date=t.substring(0,10),console.log(t),date.substring(0,5)+date.substring(5,8)+date.substring(8,10)})}),$(function(){window.template&&(template.defaults.imports.timeSince=function(t){var n=new Date(t),e=n.getTime(),s=((new Date).getTime()-e)/1e3;return s<60?"刚刚":60<=s&&s<3600?(minutes=parseInt(s/60),minutes+"分钟前"):3600<=s&&s<86400?(hours=parseInt(s/60/60),hours+"小时前"):86400<=s&&s<2592e3?(days=parseInt(s/60/60/24),days+"天前"):n.getFullYear()+"-"+n.getMonth()+"-"+n.getDay()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZyb250X2Jhc2UuanMiXSwibmFtZXMiOlsiRnJvbnRCYXNlIiwiQXV0aCIsInNlbGYiLCJ0aGlzIiwibWFza1dyYXBwZXIiLCIkIiwic2Nyb2xsV3JhcHBlciIsInNtc0NhcHRjaGEiLCJwcm90b3R5cGUiLCJydW4iLCJsaXN0ZW5BdXRoQm94SG92ZXIiLCJhdXRoQm94IiwidXNlck1vcmVCb3giLCJob3ZlciIsInNob3ciLCJoaWRlIiwibGlzdGVuU2hvd0hpZGVFdmVudCIsImxpc3RlblN3aXRjaEV2ZW50IiwibGlzdGVuU2lnbmluRXZlbnQiLCJsaXN0ZW5JbWdDYXB0Y2hhRXZlbnQiLCJsaXN0ZW5TbXNDYXB0Y2hhRXZlbnQiLCJsaXN0ZW5TaWdudXBFdmVudCIsInNob3dFdmVudCIsImhpZGVFdmVudCIsInNtc1N1Y2Nlc3NFdmVudCIsImFkZENsYXNzIiwiY291bnQiLCJ1bmJpbmQiLCJ0aW1lciIsInNldEludGVydmFsIiwidGV4dCIsImNsZWFySW50ZXJ2YWwiLCJyZW1vdmVDbGFzcyIsInNpZ25pbkJ0biIsInNpZ251cEJ0biIsImNsb3NlQnRuIiwiY2xpY2siLCJjc3MiLCJsZWZ0IiwidmFsIiwiY3VycmVudExlZnQiLCJwYXJzZUludCIsImFuaW1hdGUiLCJpbWdDYXB0Y2hhIiwiYXR0ciIsIk1hdGgiLCJyYW5kb20iLCJ0ZWxlcGhvbmVJbnB1dCIsIm15cmVnIiwidGVsZXBob25lIiwidGVzdCIsIm1lc3NhZ2VCb3giLCJzaG93SW5mbyIsImJsb2dhamF4IiwiZ2V0IiwidXJsIiwiZGF0YSIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJmYWlsIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwic2hvd0Vycm9yIiwic2lnbmluR3JvdXAiLCJmaW5kIiwicGFzc3dvcmRJbnB1dCIsInJlbWVtYmVySW5wdXQiLCJwYXNzd29yZCIsInJlbWVtYmVyIiwicHJvcCIsInBvc3QiLCJzZXRUaW1lb3V0Iiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJzaWdudXBHcm91cCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJ1c2VybmFtZUlucHV0IiwiaW1nQ2FwdGNoYUlucHV0IiwicGFzc3dvcmQxSW5wdXQiLCJwYXNzd29yZDJJbnB1dCIsInNtc0NhcHRjaGFJbnB1dCIsInVzZXJuYW1lIiwiaW1nX2NhcHRjaGEiLCJwYXNzd29yZDEiLCJwYXNzd29yZDIiLCJzbXNfY2FwdGNoYSIsInRlbXBsYXRlIiwiZGVmYXVsdHMiLCJpbXBvcnRzIiwidGltZU5vcm1hbCIsImRhdGVWYWx1ZSIsImRhdGUiLCJzdWJzdHJpbmciLCJ0aW1lU2luY2UiLCJEYXRlIiwiZGF0ZXRzIiwiZ2V0VGltZSIsInRpbWVzdGFtcCIsIm1pbnV0ZXMiLCJob3VycyIsImRheXMiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0RGF5Il0sIm1hcHBpbmdzIjoiQUFFQSxTQUFTQSxhQXFCVCxTQUFTQyxPQUNMLElBQUlDLEVBQU9DLEtBQ1hELEVBQUtFLFlBQWNDLEVBQUUsaUJBQ3JCSCxFQUFLSSxjQUFnQkQsRUFBRSxtQkFDdkJILEVBQUtLLFdBQWFGLEVBQUUsb0JBdEJ4QkwsVUFBVVEsVUFBVUMsSUFBTSxXQUNYTixLQUNOTyxzQkFHVFYsVUFBVVEsVUFBVUUsbUJBQXFCLFdBQ3JDLElBQUlDLEVBQVVOLEVBQUUsYUFDWk8sRUFBY1AsRUFBRSxrQkFDcEJNLEVBQVFFLE1BQU0sV0FDVkQsRUFBWUUsUUFDZCxXQUNFRixFQUFZRyxVQWNwQmQsS0FBS08sVUFBVUMsSUFBTSxXQUNqQixJQUFJUCxFQUFPQyxLQUNYRCxFQUFLYyxzQkFDTGQsRUFBS2Usb0JBQ0xmLEVBQUtnQixvQkFDTGhCLEVBQUtpQix3QkFDTGpCLEVBQUtrQix3QkFDTGxCLEVBQUttQixxQkFHVHBCLEtBQUtPLFVBQVVjLFVBQVksV0FDWm5CLEtBQ05DLFlBQVlVLFFBR3JCYixLQUFLTyxVQUFVZSxVQUFZLFdBQ1pwQixLQUNOQyxZQUFZVyxRQUdyQmQsS0FBS08sVUFBVWdCLGdCQUFrQixXQUM3QixJQUFJ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Q2pDLE9BQUdFLEVBQVksR0FDSixLQUVVLElBQWJBLEdBQW1CQSxFQUFZLE1BQ25DQyxRQUFVNUQsU0FBUzJELEVBQVksSUFDeEJDLFFBQVEsT0FFRSxNQUFiRCxHQUFzQkEsRUFBWSxPQUN0Q0UsTUFBUTdELFNBQVMyRCxFQUFZLEdBQUssSUFDM0JFLE1BQU0sT0FFSSxPQUFiRixHQUF5QkEsRUFBWSxRQUN6Q0csS0FBTzlELFNBQVMyRCxFQUFZLEdBQUssR0FBSyxJQUMvQkcsS0FBTyxNQUVIVCxFQUFLVSxjQUlKLElBSEFWLEVBQUtXLFdBR0ssSUFGWlgsRUFBS1kiLCJmaWxlIjoiZnJvbnRfYmFzZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLy8g55So5p2l5aSE55CG5a+86Iiq5p2h55qEXHJcbmZ1bmN0aW9uIEZyb250QmFzZSgpIHt9XHJcblxyXG5cclxuRnJvbnRCYXNlLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLmxpc3RlbkF1dGhCb3hIb3ZlcigpO1xyXG59O1xyXG5cclxuRnJvbnRCYXNlLnByb3RvdHlwZS5saXN0ZW5BdXRoQm94SG92ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYXV0aEJveCA9ICQoXCIuYXV0aC1ib3hcIik7XHJcbiAgICB2YXIgdXNlck1vcmVCb3ggPSAkKFwiLnVzZXItbW9yZS1ib3hcIik7XHJcbiAgICBhdXRoQm94LmhvdmVyKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB1c2VyTW9yZUJveC5zaG93KCk7XHJcbiAgICB9LGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB1c2VyTW9yZUJveC5oaWRlKCk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5cclxuLy8g55So5p2l5aSE55CG55m75b2V5ZKM5rOo5YaM55qEXHJcbmZ1bmN0aW9uIEF1dGgoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLm1hc2tXcmFwcGVyID0gJCgnLm1hc2std3JhcHBlcicpO1xyXG4gICAgc2VsZi5zY3JvbGxXcmFwcGVyID0gJChcIi5zY3JvbGwtd3JhcHBlclwiKTtcclxuICAgIHNlbGYuc21zQ2FwdGNoYSA9ICQoJy5zbXMtY2FwdGNoYS1idG4nKTtcclxufVxyXG5cclxuQXV0aC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5saXN0ZW5TaG93SGlkZUV2ZW50KCk7XHJcbiAgICBzZWxmLmxpc3RlblN3aXRjaEV2ZW50KCk7XHJcbiAgICBzZWxmLmxpc3RlblNpZ25pbkV2ZW50KCk7XHJcbiAgICBzZWxmLmxpc3RlbkltZ0NhcHRjaGFFdmVudCgpO1xyXG4gICAgc2VsZi5saXN0ZW5TbXNDYXB0Y2hhRXZlbnQoKTtcclxuICAgIHNlbGYubGlzdGVuU2lnbnVwRXZlbnQoKTtcclxufTtcclxuXHJcbkF1dGgucHJvdG90eXBlLnNob3dFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHNlbGYubWFza1dyYXBwZXIuc2hvdygpO1xyXG59O1xyXG5cclxuQXV0aC5wcm90b3R5cGUuaGlkZUV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5tYXNrV3JhcHBlci5oaWRlKCk7XHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5zbXNTdWNjZXNzRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAvL21lc3NhZ2VCb3guc2hvd1N1Y2Nlc3MoJ+efreS/oemqjOivgeeggeWPkemAgeaIkOWKn++8gScpO1xyXG4gICAgc2VsZi5zbXNDYXB0Y2hhLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xyXG4gICAgdmFyIGNvdW50ID0gMTA7XHJcbiAgICBzZWxmLnNtc0NhcHRjaGEudW5iaW5kKCdjbGljaycpO1xyXG4gICAgdmFyIHRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYuc21zQ2FwdGNoYS50ZXh0KGNvdW50KydzJyk7XHJcbiAgICAgICAgY291bnQgLT0gMTtcclxuICAgICAgICBpZihjb3VudCA8PSAwKXtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XHJcbiAgICAgICAgICAgIHNlbGYuc21zQ2FwdGNoYS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgc2VsZi5zbXNDYXB0Y2hhLnRleHQoJ+WPkemAgemqjOivgeeggScpO1xyXG4gICAgICAgICAgICBzZWxmLmxpc3RlblNtc0NhcHRjaGFFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sMTAwMCk7XHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5TaG93SGlkZUV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIHNpZ25pbkJ0biA9ICQoJy5zaWduaW4tYnRuJyk7XHJcbiAgICB2YXIgc2lnbnVwQnRuID0gJCgnLnNpZ251cC1idG4nKTtcclxuICAgIHZhciBjbG9zZUJ0biA9ICQoJy5jbG9zZS1idG4nKTtcclxuXHJcblxyXG5cclxuICAgIHNpZ25pbkJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2VsZi5zaG93RXZlbnQoKTtcclxuICAgICAgICBzZWxmLnNjcm9sbFdyYXBwZXIuY3NzKHtcImxlZnRcIjowfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzaWdudXBCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYuc2hvd0V2ZW50KCk7XHJcbiAgICAgICAgc2VsZi5zY3JvbGxXcmFwcGVyLmNzcyh7XCJsZWZ0XCI6LTQwMH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2xvc2VCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYuaGlkZUV2ZW50KCk7XHJcbiAgICAgICAgLy8kKCcjaW1nLWNhcHRjaGEnKS52YWwoJycpO1xyXG4gICAgICAgICQoJy5mb3JtLWNvbnRyb2wnKS52YWwoJycpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5Td2l0Y2hFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBzd2l0Y2hlciA9ICQoXCIuc3dpdGNoXCIpO1xyXG4gICAgc3dpdGNoZXIuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjdXJyZW50TGVmdCA9IHNlbGYuc2Nyb2xsV3JhcHBlci5jc3MoXCJsZWZ0XCIpO1xyXG4gICAgICAgIGN1cnJlbnRMZWZ0ID0gcGFyc2VJbnQoY3VycmVudExlZnQpO1xyXG4gICAgICAgIGlmKGN1cnJlbnRMZWZ0IDwgMCl7XHJcbiAgICAgICAgICAgIHNlbGYuc2Nyb2xsV3JhcHBlci5hbmltYXRlKHtcImxlZnRcIjonMCd9KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgc2VsZi5zY3JvbGxXcmFwcGVyLmFuaW1hdGUoe1wibGVmdFwiOlwiLTQwMHB4XCJ9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbkF1dGgucHJvdG90eXBlLmxpc3RlbkltZ0NhcHRjaGFFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBpbWdDYXB0Y2hhID0gJCgnLmltZy1jYXB0Y2hhJyk7XHJcbiAgICBpbWdDYXB0Y2hhLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpbWdDYXB0Y2hhLmF0dHIoXCJzcmNcIixcIi9hY2NvdW50L2ltZ19jYXB0Y2hhL1wiK1wiP3JhbmRvbT1cIitNYXRoLnJhbmRvbSgpKVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5TbXNDYXB0Y2hhRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgc21zQ2FwdGNoYSA9ICQoXCIuc21zLWNhcHRjaGEtYnRuXCIpO1xyXG4gICAgdmFyIHRlbGVwaG9uZUlucHV0ID0gJChcIi5zaWdudXAtZ3JvdXAgaW5wdXRbbmFtZT0ndGVsZXBob25lJ11cIik7XHJcbiAgICB2YXIgbXlyZWc9L15bMV1bMyw0LDUsNyw4LDldWzAtOV17OX0kLztcclxuICAgIHNtc0NhcHRjaGEuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ZWxlcGhvbmUgPSB0ZWxlcGhvbmVJbnB1dC52YWwoKTtcclxuICAgICAgICBpZighbXlyZWcudGVzdCh0ZWxlcGhvbmUpKXtcclxuICAgICAgICAgICAgbWVzc2FnZUJveC5zaG93RXJyb3IoJ+ivt+i+k+WFpeato+ehrueahOaJi+acuuWPt+egge+8gScpO1xyXG4gICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgbWVzc2FnZUJveC5zaG93SW5mbygn55+t5L+h6aqM6K+B56CB5Y+R6YCB5oiQ5Yqf77yBJyk7XHJcbiAgICAgICAgICAgIGJsb2dhamF4LmdldCh7XHJcbiAgICAgICAgICAgICd1cmwnOiAnL2FjY291bnQvc21zX2NhcHRjaGEvJyxcclxuICAgICAgICAgICAgJ2RhdGEnOntcclxuICAgICAgICAgICAgICAgICd0ZWxlcGhvbmUnOiB0ZWxlcGhvbmVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNtc1N1Y2Nlc3NFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnZmFpbCc6IGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5TaWduaW5FdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBzaWduaW5Hcm91cCA9ICQoJy5zaWduaW4tZ3JvdXAnKTtcclxuICAgIHZhciB0ZWxlcGhvbmVJbnB1dCA9IHNpZ25pbkdyb3VwLmZpbmQoXCJpbnB1dFtuYW1lPSd0ZWxlcGhvbmUnXVwiKTtcclxuICAgIHZhciBwYXNzd29yZElucHV0ID0gc2lnbmluR3JvdXAuZmluZChcImlucHV0W25hbWU9J3Bhc3N3b3JkJ11cIik7XHJcbiAgICB2YXIgcmVtZW1iZXJJbnB1dCA9IHNpZ25pbkdyb3VwLmZpbmQoXCJpbnB1dFtuYW1lPSdyZW1lbWJlciddXCIpO1xyXG5cclxuICAgIHZhciBzdWJtaXRCdG4gPSBzaWduaW5Hcm91cC5maW5kKFwiLnN1Ym1pdC1idG5cIik7XHJcblxyXG4gICAgc3VibWl0QnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdGVsZXBob25lID0gdGVsZXBob25lSW5wdXQudmFsKCk7XHJcbiAgICAgICAgdmFyIHBhc3N3b3JkID0gcGFzc3dvcmRJbnB1dC52YWwoKTtcclxuICAgICAgICB2YXIgcmVtZW1iZXIgPSByZW1lbWJlcklucHV0LnByb3AoXCJjaGVja2VkXCIpO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCF0ZWxlcGhvbmUgJiYgcGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgbWVzc2FnZUJveC5zaG93RXJyb3IoJ+ivt+i+k+WFpeaJi+acuuWPt+egge+8gScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXBhc3N3b3JkICYmIHRlbGVwaG9uZSkge1xyXG4gICAgICAgICAgICBtZXNzYWdlQm94LnNob3dFcnJvcign6K+36L6T5YWl5a+G56CB77yBJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0ZWxlcGhvbmUgJiYgcGFzc3dvcmQpe1xyXG4gICAgICAgICAgICBibG9nYWpheC5wb3N0KHtcclxuICAgICAgICAgICAgJ3VybCc6ICcvYWNjb3VudC9sb2dpbi8nLFxyXG4gICAgICAgICAgICAnZGF0YSc6IHtcclxuICAgICAgICAgICAgICAgICd0ZWxlcGhvbmUnOiB0ZWxlcGhvbmUsXHJcbiAgICAgICAgICAgICAgICAncGFzc3dvcmQnOiBwYXNzd29yZCxcclxuICAgICAgICAgICAgICAgICdyZW1lbWJlcic6IHJlbWVtYmVyPzE6MFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VCb3guc2hvd0luZm8oJ+eZu+W9leaIkOWKnycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXt3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7fSw1MDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgLy9zZWxmLmhpZGVFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgLy93aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICAvL21lc3NhZ2VCb3guc2hvd0luZm8oJ+eZu+W9leaIkOWKnycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIC8vd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuXHJcbkF1dGgucHJvdG90eXBlLmxpc3RlblNpZ251cEV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNpZ251cEdyb3VwID0gJCgnLnNpZ251cC1ncm91cCcpO1xyXG4gICAgdmFyIHN1Ym1pdEJ0biA9IHNpZ251cEdyb3VwLmZpbmQoJy5zdWJtaXQtYnRuJyk7XHJcbiAgICBzdWJtaXRCdG4uY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB2YXIgdGVsZXBob25lSW5wdXQgPSBzaWdudXBHcm91cC5maW5kKFwiaW5wdXRbbmFtZT0ndGVsZXBob25lJ11cIik7XHJcbiAgICAgICAgdmFyIHVzZXJuYW1lSW5wdXQgPSBzaWdudXBHcm91cC5maW5kKFwiaW5wdXRbbmFtZT0ndXNlcm5hbWUnXVwiKTtcclxuICAgICAgICB2YXIgaW1nQ2FwdGNoYUlucHV0ID0gc2lnbnVwR3JvdXAuZmluZChcImlucHV0W25hbWU9J2ltZ19jYXB0Y2hhJ11cIik7XHJcbiAgICAgICAgdmFyIHBhc3N3b3JkMUlucHV0ID0gc2lnbnVwR3JvdXAuZmluZChcImlucHV0W25hbWU9J3Bhc3N3b3JkMSddXCIpO1xyXG4gICAgICAgIHZhciBwYXNzd29yZDJJbnB1dCA9IHNpZ251cEdyb3VwLmZpbmQoXCJpbnB1dFtuYW1lPSdwYXNzd29yZDInXVwiKTtcclxuICAgICAgICB2YXIgc21zQ2FwdGNoYUlucHV0ID0gc2lnbnVwR3JvdXAuZmluZChcImlucHV0W25hbWU9J3Ntc19jYXB0Y2hhJ11cIik7XHJcblxyXG4gICAgICAgIHZhciB0ZWxlcGhvbmUgPSB0ZWxlcGhvbmVJbnB1dC52YWwoKTtcclxuICAgICAgICB2YXIgdXNlcm5hbWUgPSB1c2VybmFtZUlucHV0LnZhbCgpO1xyXG4gICAgICAgIHZhciBpbWdfY2FwdGNoYSA9IGltZ0NhcHRjaGFJbnB1dC52YWwoKTtcclxuICAgICAgICB2YXIgcGFzc3dvcmQxID0gcGFzc3dvcmQxSW5wdXQudmFsKCk7XHJcbiAgICAgICAgdmFyIHBhc3N3b3JkMiA9IHBhc3N3b3JkMklucHV0LnZhbCgpO1xyXG4gICAgICAgIHZhciBzbXNfY2FwdGNoYSA9IHNtc0NhcHRjaGFJbnB1dC52YWwoKTtcclxuICAgICAgICAvL2lmIChpbWdfY2FwdGNoYSl7XHJcbiAgICAgICAgICAgIGJsb2dhamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzogJy9hY2NvdW50L3JlZ2lzdGVyLycsXHJcbiAgICAgICAgICAgICdkYXRhJzoge1xyXG4gICAgICAgICAgICAgICAgJ3RlbGVwaG9uZSc6IHRlbGVwaG9uZSxcclxuICAgICAgICAgICAgICAgICd1c2VybmFtZSc6IHVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgJ2ltZ19jYXB0Y2hhJzogaW1nX2NhcHRjaGEsXHJcbiAgICAgICAgICAgICAgICAncGFzc3dvcmQxJzogcGFzc3dvcmQxLFxyXG4gICAgICAgICAgICAgICAgJ3Bhc3N3b3JkMic6IHBhc3N3b3JkMixcclxuICAgICAgICAgICAgICAgICdzbXNfY2FwdGNoYSc6IHNtc19jYXB0Y2hhXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VCb3guc2hvd0luZm8oJ+azqOWGjOaIkOWKnycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXt3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7fSw1MDApO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL31cclxuICAgIH0pO1xyXG59O1xyXG5cclxuXHJcbiQoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGF1dGggPSBuZXcgQXV0aCgpO1xyXG4gICAgYXV0aC5ydW4oKTtcclxufSk7XHJcblxyXG5cclxuJChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZnJvbnRCYXNlID0gbmV3IEZyb250QmFzZSgpO1xyXG4gICAgZnJvbnRCYXNlLnJ1bigpO1xyXG59KTtcclxuXHJcbiQoZnVuY3Rpb24gKCkge1xyXG4gICAgaWYod2luZG93LnRlbXBsYXRlKXtcclxuICAgICAgICB0ZW1wbGF0ZS5kZWZhdWx0cy5pbXBvcnRzLnRpbWVOb3JtYWwgPSBmdW5jdGlvbiAoZGF0ZVZhbHVlKSB7XHJcbiAgICAgICAgICAgIGRhdGUgPSBkYXRlVmFsdWUuc3Vic3RyaW5nKDAsIDEwKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0ZVZhbHVlKTtcclxuICAgICAgICAgICAgdmFyIHllYXIgPSBkYXRlLnN1YnN0cmluZygwLDUpO1xyXG4gICAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLnN1YnN0cmluZyg1LDgpO1xyXG4gICAgICAgICAgICB2YXIgZGF5ID0gZGF0ZS5zdWJzdHJpbmcoOCwxMCk7XHJcbiAgICAgICAgICAgIHJldHVybiB5ZWFyK21vbnRoK2RheVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcblxyXG4kKGZ1bmN0aW9uICgpIHtcclxuICAgIGlmKHdpbmRvdy50ZW1wbGF0ZSl7XHJcbiAgICAgICAgdGVtcGxhdGUuZGVmYXVsdHMuaW1wb3J0cy50aW1lU2luY2UgPSBmdW5jdGlvbiAoZGF0ZVZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoZGF0ZVZhbHVlKTtcclxuICAgICAgICAgICAgdmFyIGRhdGV0cyA9IGRhdGUuZ2V0VGltZSgpOyAvLyDlvpfliLDnmoTmmK/mr6vnp5LnmoRcclxuICAgICAgICAgICAgdmFyIG5vd3RzID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsgLy/lvpfliLDnmoTmmK/lvZPliY3ml7bpl7TnmoTml7bpl7TmiLNcclxuICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IChub3d0cyAtIGRhdGV0cykvMTAwMDsgLy8g6Zmk5LulMTAwMO+8jOW+l+WIsOeahOaYr+enklxyXG4gICAgICAgICAgICBpZih0aW1lc3RhbXAgPCA2MCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICfliJrliJonO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYodGltZXN0YW1wID49IDYwICYmIHRpbWVzdGFtcCA8IDYwKjYwKSB7XHJcbiAgICAgICAgICAgICAgICBtaW51dGVzID0gcGFyc2VJbnQodGltZXN0YW1wIC8gNjApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1pbnV0ZXMrJ+WIhumSn+WJjSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZih0aW1lc3RhbXAgPj0gNjAqNjAgJiYgdGltZXN0YW1wIDwgNjAqNjAqMjQpIHtcclxuICAgICAgICAgICAgICAgIGhvdXJzID0gcGFyc2VJbnQodGltZXN0YW1wIC8gNjAgLyA2MCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaG91cnMrJ+Wwj+aXtuWJjSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZih0aW1lc3RhbXAgPj0gNjAqNjAqMjQgJiYgdGltZXN0YW1wIDwgNjAqNjAqMjQqMzApIHtcclxuICAgICAgICAgICAgICAgIGRheXMgPSBwYXJzZUludCh0aW1lc3RhbXAgLyA2MCAvIDYwIC8gMjQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRheXMgKyAn5aSp5YmNJztcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcclxuICAgICAgICAgICAgICAgIHZhciBkYXkgPSBkYXRlLmdldERheSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB5ZWFyKyctJyttb250aCsnLScrZGF5XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pOyJdfQ==
